<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>BeNova Breakout</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #1c0f44; display: block; margin: 0 auto; }
    </style>
</head>
<body>

<canvas id="canvas" width="150" height="320" tabindex="1"></canvas>

<script>
	var canvas = document.getElementById("canvas");
	document.body.addEventListener("keydown", function (e) {
		keys[e.keyCode] = true;
	});
	document.body.addEventListener("keyup", function (e) {
		keys[e.keyCode] = false;
	});
	
	canvas.onmousedown = function(e){
		mouseClicked = true;

		var rect = canvas.getBoundingClientRect();
        var x = e.clientX - rect.left;
        if(x < canvas.width/2){
           	clickLeft = true;
			clickRight = false;
		}
        else{
           	clickRight = true;
			clickLeft = false;
		}
	}
	canvas.onmousemove = function(e){
		if(mouseClicked){
			var rect = canvas.getBoundingClientRect();
		    var x = e.clientX - rect.left;
		    if(x < canvas.width/2){
		       	clickLeft = true;
				clickRight = false;
			}
		    else{
		       	clickRight = true;
				clickLeft = false;
			}
		}
		// console.log(canvas.width);
		console.log(x);
	}
	canvas.onmouseup = function(e){
		mouseClicked = false;
		clickLeft = false;
		clickRight = false;
	}

	// document.body.onmousemove = function(e){
	// 	var rect = canvas.getBoundingClientRect();
	//     var x = e.clientX - rect.left;
	// 	if(x < 0 || x > canvas.width){
	// 		mouseClicked = false;
	// 		clickLeft = false;
	// 		clickRight = false;
	// 	}
	// 	else{
	// 		mouseClicked = true;
	// 	}
		
	// }
//         canvas.addEventListener("click", function (e) {
//                 var rect = canvas.getBoundingClientRect();
//                 var x = e.clientX - rect.left;
//                 if(x < canvas.width/2)
//                     clickLeft = true;
//                 else
//                     clickRight = true;
//         });
	var ctx = canvas.getContext("2d");
	var ballX = canvas.width/2;
	var ballY = canvas.height-40;
	var radius = 3;
	var dx = 0.01;
	var dy = -1.25;
	var acceleration = 0.9;
	var batDx = 0;
	var batDxMax = 1;
	var width = 6;
	var height = 6;
	var offsetX = 30;
	var offsetY = 10;
	var bat = {x : canvas.width/2-15, y : canvas.height - 30, width : 30, height : 5};
	var keys = [];
    var clickLeft = false;
    var clickRight = false;
    var mouseClicked = false;
	var blocks = [];

	blocks[0] = {x : offsetX + width * 0, y : offsetY + height * 0};
	blocks[1] = {x : offsetX + width * 2, y : offsetY + height * 0};
	blocks[2] = {x : offsetX + width * 3, y : offsetY + height * 0};
	blocks[3] = {x : offsetX + width * 4, y : offsetY + height * 0};
	blocks[4] = {x : offsetX + width * 5, y : offsetY + height * 0};
	blocks[5] = {x : offsetX + width * 0, y : offsetY + height * 1};
	blocks[6] = {x : offsetX + width * 6, y : offsetY + height * 1};
	blocks[7] = {x : offsetX + width * 0, y : offsetY + height * 2};
	blocks[8] = {x : offsetX + width * 6, y : offsetY + height * 2};
	blocks[9] = {x : offsetX + width * 0, y : offsetY + height * 3};
	blocks[10] = {x : offsetX + width * 6, y : offsetY + height * 3};
	blocks[11] = {x : offsetX + width * 6, y : offsetY + height * 4};
	blocks[12] = {x : offsetX + width * 0, y : offsetY + height * 5};
	blocks[13] = {x : offsetX + width * 1, y : offsetY + height * 5};
	blocks[14] = {x : offsetX + width * 2, y : offsetY + height * 5};
	blocks[15] = {x : offsetX + width * 3, y : offsetY + height * 5};
	blocks[16] = {x : offsetX + width * 4, y : offsetY + height * 5};
	blocks[17] = {x : offsetX + width * 5, y : offsetY + height * 5};
	blocks[18] = {x : offsetX + width * 0, y : offsetY + height * 6};
	blocks[19] = {x : offsetX + width * 6, y : offsetY + height * 6};
	blocks[20] = {x : offsetX + width * 0, y : offsetY + height * 7};
	blocks[21] = {x : offsetX + width * 7, y : offsetY + height * 7};
	blocks[22] = {x : offsetX + width * 0, y : offsetY + height * 8};
	blocks[23] = {x : offsetX + width * 7, y : offsetY + height * 8};
	blocks[24] = {x : offsetX + width * 0, y : offsetY + height * 9};
	blocks[25] = {x : offsetX + width * 7, y : offsetY + height * 9};
	blocks[26] = {x : offsetX + width * 0, y : offsetY + height * 10};
	blocks[27] = {x : offsetX + width * 6, y : offsetY + height * 10};
	blocks[28] = {x : offsetX + width * 0, y : offsetY + height * 11};
	blocks[29] = {x : offsetX + width * 1, y : offsetY + height * 11};
	blocks[30] = {x : offsetX + width * 2, y : offsetY + height * 11};
	blocks[31] = {x : offsetX + width * 3, y : offsetY + height * 11};
	blocks[32] = {x : offsetX + width * 4, y : offsetY + height * 11};
	blocks[33] = {x : offsetX + width * 5, y : offsetY + height * 11};
	blocks[34] = {x : offsetX + width * 9, y : offsetY + height * 7};
	blocks[35] = {x : offsetX + width * 10, y : offsetY + height * 7};
	blocks[36] = {x : offsetX + width * 11, y : offsetY + height * 7};
	blocks[37] = {x : offsetX + width * 12, y : offsetY + height * 7};
	blocks[38] = {x : offsetX + width * 9, y : offsetY + height * 9};
	blocks[39] = {x : offsetX + width * 10, y : offsetY + height * 9};
	blocks[40] = {x : offsetX + width * 11, y : offsetY + height * 9};
	blocks[41] = {x : offsetX + width * 12, y : offsetY + height * 9};
	blocks[42] = {x : offsetX + width * 9, y : offsetY + height * 10};
	blocks[43] = {x : offsetX + width * 9, y : offsetY + height * 11};
	blocks[44] = {x : offsetX + width * 10, y : offsetY + height * 11};
	blocks[45] = {x : offsetX + width * 11, y : offsetY + height * 11};
	blocks[46] = {x : offsetX + width * 12, y : offsetY + height * 11};

	for(var i = 0; i < blocks.length; i++){
		blocks[i].color = "#f4f4f4";
		blocks[i].alive = true;
	}

	blocks[0].color = "#de1c75";
	blocks[5].color = "#de1c75";
	blocks[7].color = "#de1c75";
	blocks[9].color = "#de1c75";
	blocks[34].color = "#de1c75";
	blocks[35].color = "#de1c75";
	blocks[36].color = "#de1c75";
	blocks[37].color = "#de1c75";
	// blocks[0].x = 10;
	// blocks[0].y = 10;
	// blocks[0].width = 5;
	// blocks[0].height = 5;
	function checkCollisions(x1, y1, w1, h1, x2, y2, w2, h2){
		if(x1 + w1 > x2 && x1 < x2 + w2 && y1 + h1 > y2 && y1 < y2 + h2)
			return true;
		else
			return false;
	}
	
	function checkEdgeCollisions(x1, y1, w1, h1, x2, y2, w2, h2){
		// Rect 1 Right Edge
		if(checkCollisions(x1+w1-1, y1+1, 1, h1-2, x2, y2+1, 1, h2-2))
			return "right";
		// Rect 1 Left Edge
		else if(checkCollisions(x1, y1+1, 1, h1-2, x2+w2-1, y2+1, 1, h2-2))
			return "left";
		// Rect 1 Top Edge
		else if(checkCollisions(x1+1, y1, w1-2, 1, x2+1, y2+h2-1, w2-2, 1))
			return "top";
		// Rect 1 Bottom Edge
		else if(checkCollisions(x1+1, y1+h1-1, w1-2, 1, x2+1, y2, w2-2, 1))
			return "bottom";
		else
			return "null";
	}

	function draw(){
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		ctx.beginPath();
		ctx.arc(ballX, ballY, radius, 0, Math.PI*2);
		ctx.fillStyle = "#de1c75";
		ctx.fill();
		ctx.closePath();

		if(keys[39] || clickRight)
			if(batDx < batDxMax)
				batDx++;
		if(keys[37] || clickLeft)
			if(batDx > -batDxMax)
				batDx--;	
		if(bat.x >= 0 && bat.x + bat.width <= canvas.width){
			bat.x += batDx;
			batDx *= acceleration;
		}
//                 clickLeft = false;
//                 clickRight = false;
		if(bat.x < 0)
			bat.x = 0;
		if(bat.x + bat.width > canvas.width)
			bat.x = canvas.width - bat.width;
		ballX += dx;
		ballY += dy;
		if(ballX + radius >= canvas.width)
			dx = -dx;
		if(ballX - radius <= 0)
			dx = -dx;
		if(ballY + radius >= canvas.height+30){}
			// dy = -dy;
		if(ballY - radius <= 0)
			dy = -dy;
		if(ballX < 0)
			ballX = 1 + radius;
		if(ballX + radius > canvas.width)
			ballX = canvas.width - radius;
		if(ballX + radius >= bat.x && ballX - radius <= bat.x + bat.width && ballY + radius >= bat.y && ballY - radius <= bat.y + bat.height){
			var ballOnBatRatio = (ballX - bat.x) / bat.width;
			dx = (ballOnBatRatio * 2) - 1;
			dy = -dy;
		}

		for (var i = 0; i < blocks.length; i++) {
			if(blocks[i].alive){
				ctx.beginPath();
				ctx.rect(blocks[i].x, blocks[i].y, width-1, height-1);
				ctx.fillStyle = blocks[i].color;
				ctx.fill();
				ctx.closePath();	
				//if(ballX+radius >= blocks[i].x && ballX-radius <= blocks[i].x+width-1 && ballY+radius >= blocks[i].y && ballY-radius <= blocks[i].y+height-1){
				if(checkCollisions(ballX-radius, ballY-radius, radius*2, radius*2, blocks[i].x, blocks[i].y, width-1, height-1)){
					blocks[i].alive = false;
					var collisionSide = checkEdgeCollisions(ballX-radius, ballY-radius, radius*2, radius*2, blocks[i].x, blocks[i].y, width-1, height-1);
					if(collisionSide == "right")
						dx = -1;
					else if(collisionSide == "left")
						dx = 1;
					else if(collisionSide == "top")
						dy = Math.abs(dy);
					else if(collisionSide == "bottom")
						dy = -Math.abs(dy);
					// if(ballX+radius < blocks[i].x+(width-1)/6 || ballX-radius > blocks[i].x+(width-1)*5/6){
					// 	dx = -dx;
					// } else{
					// 	dy = -dy;
					// }
				}
			}
		}
		ctx.beginPath();
		ctx.rect(bat.x, bat.y, bat.width, bat.height);
		ctx.fillStyle = "#de1c75";
		ctx.fill();
		ctx.closePath();
	}
	setInterval(draw, 10);
	// ctx.beginPath();
	// ctx.rect(80, 10, 60, 30);
	// ctx.fillStyle = "#de1c75";
	// ctx.fill();
	// ctx.closePath();
	
</script>

</body>
</html>
